<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="移动端优化的老虎机游戏">
    <title>老虎机游戏 - 移动端优化版</title>
    
    <link rel="manifest" href="manifest.json">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="game-container">
        <div class="top-info">
            <div id="win-loss-table" class="info-box">
                <h3>记录</h3>
                <div class="scrollable-content">
                    <table>
                        <thead>
                            <tr>
                                <th>局</th>
                                <th>结果</th>
                                <th>金额</th>
                                <th>时间</th>
                            </tr>
                        </thead>
                        <tbody id="win-loss-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="jackpot-display" class="info-box jackpot-box">
                <div class="jackpot-label">JACKPOT</div>
                <div id="jackpot-amount" class="jackpot-amount">5000.00</div>
            </div>

            <div id="announcement-board" class="info-box">
                <div id="announcement-content">欢迎回来！好运常伴！</div>
            </div>
        </div>

        <div id="reels-section">
            <div class="reel-container">
                <div class="reel" data-index="0"><div class="reel-strip"></div></div>
            </div>
            <div class="reel-container">
                <div class="reel" data-index="1"><div class="reel-strip"></div></div>
            </div>
            <div class="reel-container">
                <div class="reel" data-index="2"><div class="reel-strip"></div></div>
            </div>
            <div class="reel-container">
                <div class="reel" data-index="3"><div class="reel-strip"></div></div>
            </div>
            <div class="reel-container">
                <div class="reel" data-index="4"><div class="reel-strip"></div></div>
            </div>
            <canvas id="win-lines-canvas"></canvas>
        </div>

        <div id="control-panel">
            <div class="display-section">
                <div class="display-item">
                    <span class="label">余额</span>
                    <span id="balance-display" class="value">1000.00</span>
                </div>
                <div class="display-item bet-control">
                    <button id="btn-bet-down" class="control-btn bet-btn">-</button>
                    <div class="bet-info">
                        <span class="label">押注</span>
                        <span id="bet-display" class="value">1.00</span>
                    </div>
                    <button id="btn-bet-up" class="control-btn bet-btn">+</button>
                </div>
                <div class="display-item">
                    <span class="label">总押注</span>
                    <span id="total-bet-display" class="value">25.00</span>
                </div>
            </div>

            <div class="control-buttons">
                <button id="btn-paytable" class="control-btn secondary-btn" title="查看赔率表">赔率表</button>
                <button id="btn-autoplay" class="control-btn secondary-btn" title="自动旋转">自动</button>
                <button id="btn-spin" class="control-btn primary-btn" title="旋转">SPIN</button>
                <button id="btn-stop" class="control-btn primary-btn hidden" title="快速停止">停止</button>
            </div>
            
            <div class="display-section">
                <div class="display-item win-display">
                    <span class="label">赢取</span>
                    <span id="win-display" class="value win-amount">0.00</span>
                </div>
                <div id="free-spins-display" class="display-item free-spins-display hidden">
                    <span class="label">免费</span>
                    <span id="free-spins-count" class="value free-spins-count">10</span>
                </div>
                <div id="autoplay-display" class="display-item autoplay-display hidden">
                    <span class="label">自动</span>
                    <span id="autoplay-count" class="value autoplay-count">0</span>
                </div>
            </div>
        </div>
    </div>

    <div id="paytable-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">赔率表 (40线)</div>
            <div id="paytable-content" class="paytable-grid">
                </div>
            <button id="btn-close-paytable" class="modal-btn">关闭</button>
        </div>
    </div>

    <div id="stats-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">游戏统计</div>
            <div class="stats-body">
                <div class="stats-section">
                    <h4>全局统计</h4>
                    <div class="stats-grid">
                        <div class="stat-item"><span class="stat-label">总局数</span><span id="stat-total-spins" class="stat-value">0</span></div>
                        <div class="stat-item"><span class="stat-label">总押注</span><span id="stat-total-wagered" class="stat-value">0.00</span></div>
                        <div class="stat-item"><span class="stat-label">总回报</span><span id="stat-total-won" class="stat-value">0.00</span></div>
                        <div class="stat-item"><span class="stat-label">RTP</span><span id="stat-rtp" class="stat-value">0%</span></div>
                    </div>
                </div>
                <div class="stats-section">
                    <h4>会话统计</h4>
                    <div class="stats-grid">
                        <div class="stat-item"><span class="stat-label">最大赢取</span><span id="stat-biggest-win" class="stat-value">0.00</span></div>
                        <div class="stat-item"><span class="stat-label">中奖率</span><span id="stat-hit-rate" class="stat-value">0%</span></div>
                    </div>
                </div>
            </div>
            <button id="btn-close-stats" class="modal-btn">关闭</button>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/game-state.js"></script>
    <script src="js/rtp-manager.js"></script>
    <script src="js/audio-manager.js"></script>
    <script src="js/reel-manager.js"></script>
    <script src="js/ui-manager.js"></script>
    <script src="js/game.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const wakeUpBgMusic = () => {
            const bg = new Audio('music/background/bg.mp3'); // ← 只改了这一行
            bg.loop = true;
            bg.volume = 0.3;
            bg.play().catch(() => {});
            document.removeEventListener('click', wakeUpBgMusic);
            document.removeEventListener('touchstart', wakeUpBgMusic);
        };
        document.addEventListener('click', wakeUpBgMusic, { once: true });
        document.addEventListener('touchstart', wakeUpBgMusic, { once: true });
    });
    </script>
    
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
                .then(reg => {
                    console.log('Service Worker 注册成功! 范围:', reg.scope);
                })
                .catch(err => {
                    console.error('Service Worker 注册失败:', err);
                });
        });
    }
    </script>
</body>
</html>
